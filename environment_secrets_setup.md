# FMS Automation: Environment Variables and Secrets Setup

This document outlines the necessary environment variables and secrets required for the automated deployment pipeline using Render and GitHub Actions.

## 1. Render Environment Variables & Secrets

These need to be configured in your Render service settings for both the backend (`fms-backend`) and frontend (`fms-frontend`) services. Some are set directly, while others (like passwords) should be managed as secrets.

**Backend Service (`fms-backend`):**

*   **`PYTHON_VERSION`**: Set to `3.11` (matches Dockerfile).
*   **`DATABASE_URL`**: (Secret) Connection string for your Render database. Render usually provides this automatically if you link a database.
*   **`SECRET_KEY`**: (Secret) A long, random string for Flask session security. Can be generated by Render (`generateValue: true` in `render.yaml`) or set manually.
*   **`JWT_SECRET_KEY`**: (Secret) A long, random string for JWT token security. Can be generated by Render (`generateValue: true` in `render.yaml`) or set manually.
*   **`ADMIN_EMAIL`**: The email address for the default admin user (e.g., `admin@example.com`). Used by `start.sh` via the `flask create-admin` command.
*   **`ADMIN_PASSWORD`**: (Secret) The desired password for the default admin user. Used by `start.sh` via the `flask create-admin` command. **Do not sync this value from `render.yaml` (`sync: false`); set it directly in the Render environment secrets.**
*   **`PORT`**: Render sets this automatically, but ensure it's available (e.g., `10000`) for Gunicorn in `start.sh`.
*   **`WEB_CONCURRENCY`**: (Optional) Number of Gunicorn workers. Defaults to `4` in `render.yaml`, adjust based on your instance size.

**Frontend Service (`fms-frontend`):**

*   **`VITE_API_BASE_URL`**: The **full public URL** of your deployed backend service (e.g., `https://fms-backend-ft1y.onrender.com`). This is used during the frontend build process (`npm run build`). Ensure the prefix (`VITE_`) matches your frontend framework's convention (React/Vite uses `VITE_`, Create React App uses `REACT_APP_`).

## 2. GitHub Secrets

These secrets need to be configured in your GitHub repository settings (`Settings` > `Secrets and variables` > `Actions`) for the GitHub Actions workflows to authenticate with Render.

*   **`RENDER_API_KEY`**: Your Render account API key. Find this in your Render Account Settings.
*   **`RENDER_BACKEND_DEPLOY_HOOK_URL`**: (Recommended for simplicity) The unique Deploy Hook URL for your `fms-backend` service on Render. Find this in the service's settings page on Render.
    *   *Alternatively*, if using the Render CLI/API method instead of deploy hooks, you would need `RENDER_BACKEND_SERVICE_ID` (the ID of your `fms-backend` service on Render) instead of the hook URL.
*   **`RENDER_FRONTEND_DEPLOY_HOOK_URL`**: (Recommended for simplicity) The unique Deploy Hook URL for your `fms-frontend` service on Render. Find this in the service's settings page on Render.
    *   *Alternatively*, if using the Render CLI/API method, you would need `RENDER_FRONTEND_SERVICE_ID` (the ID of your `fms-frontend` service on Render) instead of the hook URL.

**Note:** The `ADMIN_EMAIL` and `ADMIN_PASSWORD` are used by the `start.sh` script *within the Render environment*, so they need to be set in Render, not necessarily as GitHub secrets unless your workflow specifically needs them.

## Summary Table

| Variable/Secret                   | Where to Set        | Service(s)        | Notes                                                                 |
| :-------------------------------- | :------------------ | :---------------- | :-------------------------------------------------------------------- |
| `PYTHON_VERSION`                  | Render Env Var      | Backend           | e.g., `3.11`                                                          |
| `DATABASE_URL`                    | Render Secret       | Backend           | Provided by Render linked DB                                          |
| `SECRET_KEY`                      | Render Secret       | Backend           | Flask session security, can auto-generate                             |
| `JWT_SECRET_KEY`                  | Render Secret       | Backend           | JWT security, can auto-generate                                       |
| `ADMIN_EMAIL`                     | Render Env Var      | Backend           | Default admin email for `start.sh`                                    |
| `ADMIN_PASSWORD`                  | Render Secret       | Backend           | Default admin password for `start.sh` (Set directly in Render)        |
| `PORT`                            | Render Env Var      | Backend           | e.g., `10000` (Render sets, used by Gunicorn)                         |
| `WEB_CONCURRENCY`                 | Render Env Var      | Backend           | Optional Gunicorn workers (e.g., `4`)                                 |
| `VITE_API_BASE_URL`               | Render Env Var      | Frontend (Build)  | Full public URL of backend (e.g., `https://fms-backend-ft1y.onrender.com`) |
| `RENDER_API_KEY`                  | GitHub Secret       | N/A (Workflows)   | Your Render account API key                                           |
| `RENDER_BACKEND_DEPLOY_HOOK_URL`  | GitHub Secret       | N/A (Workflows)   | Deploy hook for backend service (Recommended)                         |
| `RENDER_FRONTEND_DEPLOY_HOOK_URL` | GitHub Secret       | N/A (Workflows)   | Deploy hook for frontend service (Recommended)                        |
| `RENDER_BACKEND_SERVICE_ID`       | GitHub Secret       | N/A (Workflows)   | *Alternative* to deploy hook (Backend service ID from Render)         |
| `RENDER_FRONTEND_SERVICE_ID`      | GitHub Secret       | N/A (Workflows)   | *Alternative* to deploy hook (Frontend service ID from Render)        |

Properly configuring these variables and secrets is crucial for the automated deployment pipeline to function correctly.

